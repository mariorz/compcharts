{"version":3,"sources":["oz/core.cljs"],"mappings":";AAeA,AAAA,AAACA;AACD,AAACC;AAED,AAAA,AAAgBC,AAAKC;AAArB,AACE,AAAMC,AAAWD;;AAGnB,AAAA,AAAeE,AACXC,AAAKC;AADT,AAEG,AAAMD;AAAN,AACE,AAAMA,AAAK,AAACE,AAAQF;AAApB,AAAA,AAAA,AAAA,AAAA,AACMG;AADN,AAGM,AAACC,AAAaH,AAAKD,AAAK,AAACE,AAAQC,AACjC,AAAO,AAAKE,AAGZ;AAHO,AAEE,AAAGC,AAAyB,AAAQD,AAAKL;AAC1C,AAAKO;AAAL,AACE,AAACX,AAAIW;;;AATvB;;;AAWH,AAAA,AAAMC,AAAaR,AAAKC;AAAxB,AACE,AAAMD;AAAN,AACE,AAAMA,AAAK,AAACE,AAAQF;AAApB,AAAA,AAAA,AAAA,AAAA,AACMG;AADN,AAGM,AAACC,AAAaH,AAAKD,AAAK,AAACE,AAAQC,AACjC,AAAO,AAAKE,AAGZ;AAHO,AAEE,AAAGC,AAAqB,AAAQD,AAAKL;AACtC,AAAKO;AAAL,AACE,AAACX,AAAIW;;;AATvB;;;AAWF;;;AAAA,AAAME,AAEHT;AAFH,AAGE,AAAA,AAAA,AAAA,AAAA,AAACU,AAEsB,AAAKC;AAAL,AACE,AAACZ,AAAiBC,AAAK,AAACY,AAAWD;AAH5D,AAIyB,AAAAE,AAAKF;AAAL,AAAA,AAAAG,AAAAD;AAAA,AAAAE,AAAAD,AAAA,AAAA,AAAWE;AAAX,AAAAD,AAAAD,AAAA,AAAA,AAAaG;AAAb,AACE,AAAClB,AAAiBkB,AAAS,AAACL,AAAWD;AALlE,AAMkB,AAAKX;AAAL,AAAA,AAAA;;;AAIpB;;;AAAA,AAAMkB,AAEHlB;AAFH,AAGE,AAAA,AAAA,AAAA,AAAA,AAACU,AAEsB,AAAKC;AAAL,AACE,AAACH,AAAYR,AAAK,AAACY,AAAWD;AAHvD,AAIyB,AAAAQ,AAAKR;AAAL,AAAA,AAAAS,AAAAD;AAAA,AAAAJ,AAAAK,AAAA,AAAA,AAAWJ;AAAX,AAAAD,AAAAK,AAAA,AAAA,AAAaH;AAAb,AACE,AAACT,AAAYS,AAAS,AAACL,AAAWD;AAL7D,AAMkB,AAAKX;AAAL,AAAA,AAAA;;;AAIpB,AAAA,AAAeqB,AAEZrB;AAFH,AAME,AAACsB,AACC,AAAKC;AAAL,AAAQ,AAAI,AAAK,AAACC,AAAMD,AAAG,AAAAE,AAAqB,AAACE,AAAMJ;AAA5BG,AAAA,AAAA,AAAA;AAAA,AAAA,AAAAA,AAAAA,AAAAD,AAAAC,AAAAD;AAAf;AAAJ,AACG,AAAAG,AAAM,AAACD,AAAMJ;AAAbK,AAAA,AAAA,AAAAA,AAAAC,AAAA,AAAAD,AAAA;AAAA,AAAA,AAAAA;AAAA;AAAsBV;;;AAAtB;AAAsCT;;;;AAAtC,AAAA,AAAAqB,AAAA,AAAA,AAAAF;;;AACA,AAACG,AAAOC,AAAM,AAACC,AAAKV;;AACrBA;;AACVvB","names":["taoensso.timbre/set-level!","cljs.core/enable-console-print!","oz.core/log","a-thing","js/console","oz.core/render-vega-lite","spec","elem","cljs.core/clj->js","opts","js/vegaEmbed","res","js/vegaTooltip","err","oz.core/render-vega","oz.core/vega-lite","reagent.core/create-class","this","reagent.core/dom-node","p__52037","vec__52038","cljs.core.nth","_","new-spec","oz.core/vega","p__52041","vec__52042","oz.core/view-spec","clojure.walk/prewalk","x","cljs.core/coll?","G__52048","fexpr__52047","cljs.core/first","G__52049","cljs.core/Keyword","js/Error","cljs.core.reduce","cljs.core/merge","cljs.core/rest"],"sourcesContent":["(ns ^:figwheel-always oz.core\n  (:require [reagent.core :as r]\n            [clojure.string :as str]\n            [cljs.core.async :as async  :refer (<! >! put! chan)]\n            [taoensso.encore :as encore :refer-macros (have have?)]\n            [taoensso.timbre :as log :refer-macros (tracef debugf infof warnf errorf)]\n            [taoensso.sente :as sente :refer (cb-success?)]\n            [taoensso.sente.packers.transit :as sente-transit]\n            [cljsjs.vega]\n            [cljsjs.vega-lite]\n            [cljsjs.vega-embed]\n            [cljsjs.vega-tooltip])\n  (:require-macros\n   [cljs.core.async.macros :as asyncm :refer (go go-loop)]))\n\n(log/set-level! :info)\n(enable-console-print!)\n\n(defn- ^:no-doc log [a-thing]\n  (.log js/console a-thing))\n\n\n(defn ^:no-doc render-vega-lite\n  ([spec elem]\n   (when spec\n     (let [spec (clj->js spec)\n           opts {:renderer \"canvas\"\n                 :mode \"vega-lite\"}]\n       (-> (js/vegaEmbed elem spec (clj->js opts))\n           (.then (fn [res]\n                    #_(log res)\n                    (. js/vegaTooltip (vegaLite (.-view res) spec))))\n           (.catch (fn [err]\n                     (log err))))))))\n\n(defn render-vega [spec elem]\n  (when spec\n    (let [spec (clj->js spec)\n          opts {:renderer \"canvas\"\n                :mode \"vega\"}]\n      (-> (js/vegaEmbed elem spec (clj->js opts))\n          (.then (fn [res]\n                   #_(log res)\n                   (. js/vegaTooltip (vega (.-view res) spec))))\n          (.catch (fn [err]\n                    (log err)))))))\n\n(defn vega-lite\n  \"Reagent component that renders vega-lite.\"\n  [spec]\n  (r/create-class\n   {:display-name \"vega-lite\"\n    :component-did-mount (fn [this]\n                           (render-vega-lite spec (r/dom-node this)))\n    :component-will-update (fn [this [_ new-spec]]\n                             (render-vega-lite new-spec (r/dom-node this)))\n    :reagent-render (fn [spec]\n                      [:div#vis])}))\n\n\n(defn vega\n  \"Reagent component that renders vega\"\n  [spec]\n  (r/create-class\n   {:display-name \"vega\"\n    :component-did-mount (fn [this]\n                           (render-vega spec (r/dom-node this)))\n    :component-will-update (fn [this [_ new-spec]]\n                             (render-vega new-spec (r/dom-node this)))\n    :reagent-render (fn [spec]\n                      [:div#vis])}))\n\n\n(defn ^:no-doc view-spec\n  ;; should handle sharing data with nodes that need it?\n  [spec]\n  ;; prewalk spec, rendering special hiccup tags like :vega and :vega-lite, and potentially other composites,\n  ;; rendering using the components above. Leave regular hiccup unchanged).\n  ;; TODO finish writing; already hooked in below so will break now\n  (clojure.walk/prewalk\n    (fn [x] (if (and (coll? x) (#{:vega :vega-lite} (first x)))\n              [(case (first x) :vega vega :vega-lite vega-lite)\n               (reduce merge (rest x))]\n              x))\n    spec))\n\n\n"]}